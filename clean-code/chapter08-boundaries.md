# Chapter 8. 경계

우리는 오픈 소스도 사용하고, 다른 팀이 제공하는 컴포넌트도 사용한다. 어떤 식으로든 외부 코드를 통합해야 할 때가 있는데, 여기서는 경계를 깔끔하게 처리하는 기법을 살펴본다.

## 8.1 외부 코드 사용하기

인터페이스 제공자는 다양한 인터페이스로 최대한 많은 기능을 제공하려고 한다. 하지만 사용자에게는 필요로 하는 인터페이스만 있는 것이 낫다.

`Map`을 예로 들었을 때, 사용자는 내용을 지우거나, 적절하지 않은 객체 유형을 추가할 수 있다.

아래의 경우, 캐스팅 했지만 사실 `Sensor` 객체임을 장담할 수는 없다. 여기서 책임은 전적으로 사용자에게 있다. 또한 의도도 분명하지 않다. 클린 코드라 하기 어렵다.

```java
Map sensors = new HashMap();
Sensor s = (Sensor) sensors.get(sensorId);
```

_Generic_을 사용하면 가독성도 높아지고, 객체 유형을 확신할 수 있다. 하지만 `Map<Sensor>`가 사용자에게 필요하지 않은 기능\(`clear` 등\)까지 제공하는 문제는 아직 해결하지 못했다.

```java
Map<Sensor> sensors = new HashMap<Sensor>();
Sensor s = sensors.get(sensorId);
```

거기다 이 `sensors` 인스턴스가 여기 저기서 쓰인다고 생각해보면, `Map`이 변경될 경우 수정이 거의 불가능하다. 변경된 인터페이스에 맞추기 위해 많은 노력이 들 것이 뻔하다. 아래와 같이 깔끔하게 고쳐보자.

경계 인터페이스인 `Map`을 `Sensors` 클래스 안으로 숨겼다. `Map` 인터페이스가 어떻게 변경되든 한 곳만 변경하면 되며, 이제 `Sensors` 클래스는 프로그램 전체에 필요한 기능만 제공한다. `Sensors` 클래스는 이 클래스를 사용하는 코드가 설계 규칙과 비즈니스 규칙을 따르도록 _강제_할 수 있다.

```java
public class Sensors {
    private Map sensors = new HashMap();
    public Sensor getById(String id) {
        return (Sensor) sensors.get(id);
    }
}
```

항상 이렇게 `Map` 클래스를 캡슐화하라는 얘기는 아니다. 이런 _경계 인터페이스를 여기저기 넘기지 말라_는 얘기다. 이런 경계 인터페이스를 이용할 때는 이를 _이용하는 클래스나 클래스 계열 밖으로 노출되지 않도록 주의_하자.

## 8.2 경계 살피고 익히기

외부 코드의 사용법을 익히기란 어렵다. 통합하기는 더욱 더 어렵고, 두 가지를 동시에 하기는 더욱 더 어렵다더 이럴 때는 프로그램에서 사용하려는 방식대로 외부 API를 호출하는 테스트 케이스를 작성해보자. 통제된 환경에서 ㅇAPI를 제대로 이해하는지 확인할 수 있다. 이를 _학습 테스트_라 부른다.

## 8.3 log4j 익히기

log4j를 학습 테스트를 이용해 익혀보는 예제 - 책 참조

## 8.4 학습 테스트는 공짜 이상이다

학습 테스트를 이용하면 필요한 API만을 쉽게 이해하게 해줄 수 있다. 또, 패키지의 새 버전이 나오면 학습 테스트를 돌려 필요한 기능이 그대로인지 쉽게 검증할 수 있다.

## 8.5 아직 존재하지 않는 코드를 사용하기

구체적인 구현체는 없이 경계만을 알 때가 있다. 경계와 그 경계 인터페이스에서 제공해야 하는 기능은 알지만, 아직 구현이 안 되어 있을 때도 있다. 그럴 때는 그 부분을 외부 인터페이스+Fake class로 작성해두고 다른 구현을 먼저 할 수 있다. 후에 외부 인터페이스 구현이 완료되면 간극을 메꾸면 된다.

## 8.6 클린 경계

외부 패키지를 호출하는 코드를 가능한 줄여 경계를 관리하자. 새로운 클래스로 경계를 감싸거나 어댑터 패턴을 사용해 패키지가 제공하는 인터페이스를 _우리가 원하는 인터페이스_로 변환하자. 코드 가족성이 높아지고, 경계 인터페이스를 사용하는 인관성도 높아지며, 외부 패키지가 변했을 때 변경할 코드도 줄어든다. 통제가 불가능한 외부 패키지에 의존하는 대신 통제가 가능한 우리 코드에 의존하는 편이 훨씬 낫다.

